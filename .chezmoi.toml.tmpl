# Chezmoi configuration
# https://www.chezmoi.io/reference/configuration-file/

# Platform validation - fail fast on unsupported configurations
{{- if and (ne .chezmoi.os "darwin") (ne .chezmoi.os "linux") }}
{{- fail (printf "Unsupported OS: detected %s, only darwin and linux are supported" .chezmoi.os) }}
{{- end }}
{{- if and (eq .chezmoi.os "darwin") (ne .chezmoi.arch "arm64") }}
{{- fail (printf "Unsupported macOS architecture: detected %s, only arm64 (Apple Silicon) is supported" .chezmoi.arch) }}
{{- end }}

# Compute Homebrew prefix based on platform
{{- $homebrewPrefix := "" }}
{{- if eq .chezmoi.os "darwin" }}
{{-   $homebrewPrefix = "/opt/homebrew" }}
{{- else if eq .chezmoi.os "linux" }}
{{-   $homebrewPrefix = "/home/linuxbrew/.linuxbrew" }}
{{- end }}

# CRITICAL: encryption must be at top level, before any sections
encryption = "age"

# Age encryption configuration
# https://www.chezmoi.io/user-guide/encryption/
[age]
    # Path to the private key for decryption
    identity = "{{ .chezmoi.homeDir }}/.config/chezmoi/key.txt"
    # Public key for encryption - UPDATE THIS after running key generation script
    # Run: chezmoi apply (triggers key generation), then copy public key here
    recipient = "PLACEHOLDER_PUBLIC_KEY"

# Bitwarden CLI integration
# https://www.chezmoi.io/user-guide/password-managers/bitwarden/
[bitwarden]
    # "auto" only prompts for master password if BW_SESSION not already set
    unlock = "auto"

# Custom data for templates
[data]
    homebrew_prefix = "{{ $homebrewPrefix }}"

# Source directory (where chezmoi reads from)
sourceDir = "{{ .chezmoi.sourceDir }}"
