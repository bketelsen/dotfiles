---
phase: 01-foundation-bootstrap
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bootstrap.sh
  - README.md
  - .chezmoi.toml.tmpl
autonomous: true

must_haves:
  truths:
    - "User can run a single curl command that bootstraps a fresh machine"
    - "Homebrew is installed automatically if not present"
    - "chezmoi is installed and applies dotfiles automatically"
    - "Script can be re-run safely without side effects"
    - "Errors display clear messages with suggested fixes"
  artifacts:
    - path: "bootstrap.sh"
      provides: "Main bootstrap script"
      contains: "set -e"
      min_lines: 80
    - path: "README.md"
      provides: "User-facing curl command"
      contains: "curl"
    - path: ".chezmoi.toml.tmpl"
      provides: "chezmoi configuration"
      contains: "sourceDir"
  key_links:
    - from: "README.md"
      to: "bootstrap.sh"
      via: "curl command referencing raw GitHub URL"
      pattern: "curl.*bootstrap.sh"
    - from: "bootstrap.sh"
      to: "chezmoi init"
      via: "chezmoi init --apply command"
      pattern: "chezmoi init.*--apply"
---

<objective>
Create the bootstrap infrastructure that enables a fresh machine to be configured with a single curl command.

Purpose: This is the foundation of the entire dotfiles system. Without a working bootstrap, users must manually install dependencies and configure chezmoi. This plan delivers the "one command to rule them all" experience.

Output: A working bootstrap.sh script, README with curl one-liner, and minimal chezmoi configuration. After this plan, running the curl command on a fresh macOS or Linux machine will install Homebrew, install chezmoi, and apply (empty) dotfiles.
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-bootstrap/01-CONTEXT.md
@.planning/phases/01-foundation-bootstrap/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bootstrap.sh script</name>
  <files>bootstrap.sh</files>
  <action>
Create a POSIX-compatible shell script (`#!/bin/sh`) that bootstraps a fresh machine. The script must:

**Structure:**
- Use `set -e` for fail-fast behavior
- Define helper functions: `log()`, `abort()`, `setup_colors()`
- Execute in order: validate -> install -> configure -> apply -> summarize

**Required functions:**

1. `setup_colors()` - Detect terminal color support using tput, set BOLD/RED/GREEN/BLUE/RESET variables (empty if no color support)

2. `log()` - Print timestamped messages to stdout AND append to `~/.dotfiles-bootstrap.log`

3. `abort()` - Print error message to stderr with suggested fix, log to file, exit 1

4. `check_network()` - Validate connectivity to github.com and brew.sh using `curl -fsS --connect-timeout 5`

5. `detect_os()` - Set OS variable to "macos" or "linux" using `uname -s`, abort on unsupported OS

6. `install_homebrew()` - Skip if `command -v brew` succeeds, otherwise run official installer with `NONINTERACTIVE=1`

7. `configure_homebrew_path()` - Eval brew shellenv for current session, checking all three possible locations: /opt/homebrew/bin/brew (Apple Silicon), /home/linuxbrew/.linuxbrew/bin/brew (Linux), /usr/local/bin/brew (Intel Mac)

8. `install_chezmoi()` - Skip if `command -v chezmoi` succeeds, otherwise `brew install chezmoi`

9. `apply_dotfiles()` - Run `chezmoi init --apply $GITHUB_USERNAME` where GITHUB_USERNAME is set at top of script

10. `show_summary()` - Print success message with next steps (restart shell, etc.)

**Configuration at top of script:**
```sh
GITHUB_USERNAME="bjk"  # Repository owner
LOG_FILE="${HOME}/.dotfiles-bootstrap.log"
```

**Error messages must include:**
- What failed (e.g., "Failed to install Homebrew")
- Suggested fix (e.g., "Check internet connection and try again")
- Log file location for debugging

**Use patterns from RESEARCH.md** - Specifically the Homebrew installer patterns for color detection and the official install commands.

**Avoid bashisms:** No `[[ ]]`, no arrays, no process substitution `>()`. Use `[ ]` for tests, `$(cmd)` for command substitution.
  </action>
  <verify>
Run `sh -n bootstrap.sh` to verify POSIX syntax (no errors).
Run `shellcheck bootstrap.sh` if available (no errors or only style warnings).
Manually verify script contains all required functions by grepping for function names.
  </verify>
  <done>
bootstrap.sh exists, passes POSIX syntax check, contains all 10 required functions, has GITHUB_USERNAME set to "bjk", and uses only POSIX-compatible syntax.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create README.md with curl one-liner</name>
  <files>README.md</files>
  <action>
Create README.md with:

**Title:** "Dotfiles"

**Tagline:** One command to configure a fresh machine

**Quick Start section:**
```bash
sh -c "$(curl -fsSL https://raw.githubusercontent.com/bjk/dotfiles/main/bootstrap.sh)"
```

**What This Does section:**
- Installs Homebrew (if not present)
- Installs chezmoi dotfiles manager
- Applies dotfiles configuration
- Works on macOS and Linux

**Requirements section:**
- macOS or Linux
- curl (pre-installed on both)
- Internet connection

**Re-running section:**
Explain that the script is idempotent - safe to run again if interrupted or to update.

**Troubleshooting section:**
- Check ~/.dotfiles-bootstrap.log for detailed output
- Common issues: network, permissions

Keep it concise. This is a personal dotfiles repo, not enterprise documentation.
  </action>
  <verify>
File exists and contains the curl one-liner with correct GitHub raw URL.
Verify URL path matches: `https://raw.githubusercontent.com/bjk/dotfiles/main/bootstrap.sh`
  </verify>
  <done>
README.md exists with working curl command that references the correct GitHub raw URL for bootstrap.sh.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create minimal chezmoi configuration</name>
  <files>.chezmoi.toml.tmpl</files>
  <action>
Create `.chezmoi.toml.tmpl` with minimal configuration for chezmoi to work:

```toml
# Chezmoi configuration
# https://www.chezmoi.io/reference/configuration-file/

[data]
    # Will be populated in later phases

# Source directory (where chezmoi reads from)
sourceDir = "{{ .chezmoi.sourceDir }}"
```

This is a template file (`.tmpl` extension) that chezmoi processes. It establishes the configuration structure that will be expanded in later phases (encryption, platform detection, etc.).

For now, keep it minimal - just enough for `chezmoi init --apply` to succeed.
  </action>
  <verify>
File exists and is valid TOML syntax.
Run `chezmoi doctor` after init would not error on config (verified manually by checking TOML structure).
  </verify>
  <done>
.chezmoi.toml.tmpl exists with valid TOML structure and sourceDir configuration.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Syntax check:** `sh -n bootstrap.sh` returns exit code 0
2. **Structure check:** bootstrap.sh contains all required functions (grep for each)
3. **README check:** README.md contains curl command with correct URL
4. **Config check:** .chezmoi.toml.tmpl exists and is valid TOML

Note: Full end-to-end testing (actually running curl on fresh machine) is not possible in this environment. The verification focuses on structural correctness. Real validation happens when user tests on actual fresh machine.
</verification>

<success_criteria>
Phase 1 Plan 01 is complete when:
- [ ] bootstrap.sh exists with all 10 functions
- [ ] bootstrap.sh passes `sh -n` syntax check
- [ ] bootstrap.sh uses only POSIX-compatible syntax
- [ ] README.md exists with curl one-liner
- [ ] README.md curl URL matches GitHub raw URL pattern
- [ ] .chezmoi.toml.tmpl exists with valid TOML
- [ ] All files committed to git
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-bootstrap/01-01-SUMMARY.md`
</output>
