---
phase: 05-shell-configuration
plan: 04
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - dot_zsh/functions.d/git.sh
  - dot_zsh/functions.d/nav.sh
  - dot_zsh/functions.d/utils.sh
  - dot_bash/functions.d/git.sh
  - dot_bash/functions.d/nav.sh
  - dot_bash/functions.d/utils.sh
autonomous: true

must_haves:
  truths:
    - "Git shortcuts (gs, ga, gc, gp) work in both shells"
    - "Modern CLI aliases (cat->bat, ls->eza, find->fd) work when tools installed"
    - "Navigation shortcuts exist for common directories"
    - "Functions work identically on both zsh and bash"
  artifacts:
    - path: "dot_zsh/functions.d/git.sh"
      provides: "Git shortcuts and functions for zsh"
      contains: "alias gs="
    - path: "dot_zsh/functions.d/nav.sh"
      provides: "Navigation shortcuts for zsh"
      contains: "alias .."
    - path: "dot_zsh/functions.d/utils.sh"
      provides: "Modern CLI aliases for zsh"
      contains: "alias cat="
    - path: "dot_bash/functions.d/git.sh"
      provides: "Git shortcuts and functions for bash"
      contains: "alias gs="
    - path: "dot_bash/functions.d/nav.sh"
      provides: "Navigation shortcuts for bash"
      contains: "alias .."
    - path: "dot_bash/functions.d/utils.sh"
      provides: "Modern CLI aliases for bash"
      contains: "alias cat="
  key_links:
    - from: "dot_zsh/functions.d/utils.sh"
      to: "bat/eza/fd"
      via: "conditional alias"
      pattern: "command -v bat.*alias cat"
    - from: "dot_bash/functions.d/utils.sh"
      to: "bat/eza/fd"
      via: "conditional alias"
      pattern: "command -v bat.*alias cat"
---

<objective>
Create modular functions.d directories with git shortcuts, navigation aliases, and modern CLI tool integrations.

Purpose: Organizes shell customizations by purpose (git, nav, utils) for easy maintenance. Same functions work on both zsh and bash.

Output: Six function files (3 for zsh, 3 for bash) with identical functionality
</objective>

<execution_context>
@/home/bjk/.claude/get-shit-done/workflows/execute-plan.md
@/home/bjk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-shell-configuration/05-CONTEXT.md
@.planning/phases/05-shell-configuration/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create git.sh for both shells</name>
  <files>dot_zsh/functions.d/git.sh, dot_bash/functions.d/git.sh</files>
  <action>
Create identical `git.sh` files in both `dot_zsh/functions.d/` and `dot_bash/functions.d/`.

Content (POSIX-compatible syntax for both shells):
```bash
# Git shortcuts and helper functions
# Sourced by .zshrc / .bashrc

# Status and diff
alias gs='git status'
alias gst='git status --short'
alias gd='git diff'
alias gds='git diff --staged'

# Adding and committing
alias ga='git add'
alias gaa='git add --all'
alias gc='git commit'
alias gcmsg='git commit -m'
alias gca='git commit --amend'

# Pushing and pulling
alias gp='git push'
alias gpf='git push --force-with-lease'
alias gl='git pull'

# Branching
alias gb='git branch'
alias gco='git checkout'
alias gcb='git checkout -b'
alias gsw='git switch'
alias gswc='git switch -c'

# Logging
alias glog='git log --oneline --graph --decorate -10'
alias gloga='git log --oneline --graph --decorate --all -20'

# Helpers
alias gundo='git reset --soft HEAD~1'
alias gunstage='git restore --staged'

# Functions
# Git add all and commit with message
gac() {
  git add --all && git commit -m "$*"
}

# Git add, commit, and push
gcp() {
  git add --all && git commit -m "$*" && git push
}

# Git checkout main/master (whichever exists)
gcom() {
  if git show-ref --verify --quiet refs/heads/main; then
    git checkout main
  elif git show-ref --verify --quiet refs/heads/master; then
    git checkout master
  else
    echo "Neither main nor master branch exists"
    return 1
  fi
}
```

Create both directories with `chezmoi` naming convention: `dot_zsh` becomes `~/.zsh`.
  </action>
  <verify>
Run:
- `chezmoi cat dot_zsh/functions.d/git.sh`
- `chezmoi cat dot_bash/functions.d/git.sh`
Verify both contain same aliases and functions.
  </verify>
  <done>Git shortcuts work in both zsh and bash</done>
</task>

<task type="auto">
  <name>Task 2: Create nav.sh for both shells</name>
  <files>dot_zsh/functions.d/nav.sh, dot_bash/functions.d/nav.sh</files>
  <action>
Create identical `nav.sh` files in both `dot_zsh/functions.d/` and `dot_bash/functions.d/`.

Content:
```bash
# Navigation shortcuts
# Sourced by .zshrc / .bashrc

# Directory traversal
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'

# Common directories
alias ~='cd ~'
alias dl='cd ~/Downloads'
alias dt='cd ~/Desktop'
alias dev='cd ~/dev'
alias dots='cd ~/.local/share/chezmoi'

# Directory stack (pushd/popd shortcuts)
alias d='dirs -v'
alias 1='cd -1'
alias 2='cd -2'
alias 3='cd -3'

# Make directory and cd into it
mkcd() {
  mkdir -p "$1" && cd "$1"
}

# Quick find in current directory
f() {
  find . -name "*$1*" 2>/dev/null
}
```
  </action>
  <verify>
Run:
- `chezmoi cat dot_zsh/functions.d/nav.sh`
- `chezmoi cat dot_bash/functions.d/nav.sh`
Verify both contain same aliases and functions.
  </verify>
  <done>Navigation shortcuts work in both zsh and bash</done>
</task>

<task type="auto">
  <name>Task 3: Create utils.sh for both shells</name>
  <files>dot_zsh/functions.d/utils.sh, dot_bash/functions.d/utils.sh</files>
  <action>
Create identical `utils.sh` files in both `dot_zsh/functions.d/` and `dot_bash/functions.d/`.

Content (conditional aliases only activate if tool is installed):
```bash
# Utility aliases and modern CLI replacements
# Sourced by .zshrc / .bashrc

# Modern replacements (only if installed)
# Use \command or command command to access originals

if command -v bat >/dev/null 2>&1; then
  alias cat='bat'
  alias catp='bat --plain'  # No line numbers, no paging
fi

if command -v eza >/dev/null 2>&1; then
  alias ls='eza --group-directories-first'
  alias ll='eza -la --group-directories-first'
  alias la='eza -a --group-directories-first'
  alias lt='eza --tree --level=2'
  alias lta='eza --tree --level=2 -a'
fi

if command -v fd >/dev/null 2>&1; then
  alias find='fd'
fi

# Safer defaults
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

# Quick shortcuts
alias c='clear'
alias h='history'
alias j='jobs -l'
alias path='echo $PATH | tr ":" "\n"'
alias now='date +"%Y-%m-%d %H:%M:%S"'

# Grep with color
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# Quick edit
alias ez='${EDITOR:-vim} ~/.zshrc'
alias eb='${EDITOR:-vim} ~/.bashrc'
alias sz='source ~/.zshrc'
alias sb='source ~/.bashrc'

# Get public IP
myip() {
  curl -s https://api.ipify.org && echo
}

# Extract any archive
extract() {
  if [ -f "$1" ]; then
    case "$1" in
      *.tar.bz2) tar xjf "$1" ;;
      *.tar.gz)  tar xzf "$1" ;;
      *.tar.xz)  tar xJf "$1" ;;
      *.bz2)     bunzip2 "$1" ;;
      *.rar)     unrar x "$1" ;;
      *.gz)      gunzip "$1" ;;
      *.tar)     tar xf "$1" ;;
      *.tbz2)    tar xjf "$1" ;;
      *.tgz)     tar xzf "$1" ;;
      *.zip)     unzip "$1" ;;
      *.Z)       uncompress "$1" ;;
      *.7z)      7z x "$1" ;;
      *)         echo "'$1' cannot be extracted via extract()" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}
```

Key points:
- Conditional aliases check if tool exists before aliasing
- Original commands always accessible via `\cat`, `\ls`, etc.
- Both files are identical for shell parity
  </action>
  <verify>
Run:
- `chezmoi cat dot_zsh/functions.d/utils.sh`
- `chezmoi cat dot_bash/functions.d/utils.sh`
Verify:
- Modern aliases are conditional on tool existence
- Both files have identical content
  </verify>
  <done>Utility aliases and modern CLI replacements work in both shells</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Six files exist in chezmoi source directory
2. zsh and bash versions of each file are identical
3. All functions use POSIX-compatible syntax
4. `chezmoi diff` shows all new files
</verification>

<success_criteria>
- git.sh provides gs, ga, gc, gp and other git shortcuts
- nav.sh provides .., ..., mkcd, and directory shortcuts
- utils.sh provides conditional modern CLI aliases (cat->bat, ls->eza, find->fd)
- All files work on both zsh and bash
- functions.d directories will be sourced by .zshrc and .bashrc
</success_criteria>

<output>
After completion, create `.planning/phases/05-shell-configuration/05-04-SUMMARY.md`
</output>
